<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liste des Équipes - E-Sportify</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ asset('css/styles.css') }}">
</head>
<body class="with-sidebar" data-theme="dark">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo-container">
                <img src="{{ asset('images/logo3.png') }}" alt="Logo" class="sidebar-logo-img">
            </div>
            <h1 class="sidebar-brand">E-SPORTIFY</h1>
            <div class="online-count">
                <i class="fas fa-circle"></i> +21 000 JOUEURS
            </div>
        </div>

        <nav class="sidebar-nav">
            <a href="{{ path('app_home') }}" class="nav-link active">
                <i class="fas fa-home"></i>
                <span>Accueil</span>
            </a>
            <a href="{{ path('app_equipes_index') }}" class="nav-link">
                <i class="fas fa-users"></i>
                <span>Équipes</span>
            </a>
            <a href="#" class="nav-link">
                <i class="fas fa-trophy"></i>
                <span>Tournois</span>
            </a>
            <a href="{{ path('app_front_produit_index') }}" class="nav-link">
                <i class="fas fa-shopping-cart"></i>
                <span>Boutique</span>
            </a>
            <a href="#" class="nav-link">
                <i class="fas fa-comments"></i>
                <span>Chat</span>
            </a>
            <a href="#" class="nav-link">
                <i class="fas fa-rss"></i>
                <span>News</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <a href="{{ path('app_profile') }}" class="sidebar-footer-btn">
                <i class="fas fa-user"></i>
                <span>Mon Compte</span>
            </a>
            <a href="{{ path('app_logout') }}" class="sidebar-footer-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Déconnexion</span>
            </a>
        </div>
    </aside>


    <!-- Main Content -->
    <main class="main-content">
        <button id="themeToggleTop" title="Mode Nuit" aria-label="Mode Nuit" style="position: fixed; top: 18px; right: 18px; z-index: 1001; width: 42px; height: 42px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); background: rgba(15,16,21,0.7); color: #fff; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; backdrop-filter: blur(6px);">
            <i class="fas fa-moon"></i>
        </button>
        <a href="{{ path('front_order_cart_details') }}" class="cart-fab-home" title="Voir panier" aria-label="Voir panier">
            <i class="fas fa-shopping-cart"></i>
        </a>

        <!-- Flash Messages removed from home -->

        <!-- Hero Introduction Section -->
        <div class="hero-section animate__animated animate__fadeIn" style="margin-bottom: 80px; background: linear-gradient(rgba(10, 14, 35, 0.85), rgba(10, 14, 35, 0.9)), url('{{ asset('images/gaming1.jpg') }}'); background-size: cover; background-position: center; background-attachment: fixed; border-radius: 24px; padding: 60px 40px;">
            <div class="hero-content" style="text-align: center;">
                <h1 class="hero-title" style="font-size: 56px; margin-bottom: 20px;">
                    BIENVENUE SUR E-SPORTIFY
                </h1>
                <p class="hero-subtitle" style="font-size: 22px; max-width: 800px; margin: 0 auto 40px;">
                    La plateforme ultime pour les passionnés d'e-sport. Rejoignez des équipes, participez à des tournois épiques et dominez la compétition mondiale.
                </p>
                
                <!-- Hero Stats -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; max-width: 1000px; margin: 0 auto 50px;">
                    <div style="text-align: center; padding: 20px; background: rgba(0, 217, 255, 0.05); border-radius: 16px; border: 2px solid rgba(0, 217, 255, 0.2);">
                        <div style="font-size: 42px; font-family: 'Orbitron', sans-serif; font-weight: 900; color: var(--primary-blue); margin-bottom: 5px;">
                            21K+
                        </div>
                        <div style="color: var(--text-secondary); font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">
                            Joueurs Actifs
                        </div>
                    </div>
                    
                    <div style="text-align: center; padding: 20px; background: rgba(255, 0, 110, 0.05); border-radius: 16px; border: 2px solid rgba(255, 0, 110, 0.2);">
                        <div style="font-size: 42px; font-family: 'Orbitron', sans-serif; font-weight: 900; color: var(--primary-pink); margin-bottom: 5px;">
                            500+
                        </div>
                        <div style="color: var(--text-secondary); font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">
                            Équipes Actives
                        </div>
                    </div>
                    
                    <div style="text-align: center; padding: 20px; background: rgba(123, 47, 255, 0.05); border-radius: 16px; border: 2px solid rgba(123, 47, 255, 0.2);">
                        <div style="font-size: 42px; font-family: 'Orbitron', sans-serif; font-weight: 900; color: var(--primary-purple); margin-bottom: 5px;">
                            150+
                        </div>
                        <div style="color: var(--text-secondary); font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">
                            Tournois
                        </div>
                    </div>
                    
                    <div style="text-align: center; padding: 20px; background: rgba(0, 255, 136, 0.05); border-radius: 16px; border: 2px solid rgba(0, 255, 136, 0.2);">
                        <div style="font-size: 42px; font-family: 'Orbitron', sans-serif; font-weight: 900; color: var(--success-color); margin-bottom: 5px;">
                            50K€
                        </div>
                        <div style="color: var(--text-secondary); font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">
                            Cash Prizes
                        </div>
                    </div>
                </div>

                <!-- Hero CTA Buttons -->
                <div class="hero-buttons" style="justify-content: center; margin-bottom: 50px;">
                    {% if myTeam %}
                        <a href="{{ path('app_equipes_show', {'id': myTeam.id}) }}" class="btn-gradient" style="padding: 18px 45px; font-size: 18px; text-decoration: none; display: inline-flex; align-items: center; gap: 10px;">
                            <i class="fas fa-crown"></i> Voir mon équipe
                        </a>
                    {% else %}
                        <a href="{{ path('app_manager_request') }}" class="btn-gradient" style="padding: 18px 45px; font-size: 18px; text-decoration: none; display: inline-flex; align-items: center; gap: 10px;">
                            <i class="fas fa-user-tie"></i> Devenir Manager
                        </a>
                        <button class="btn-outline" onclick="showJoinTeamModal()" style="padding: 18px 45px; font-size: 18px;">
                            <i class="fas fa-sign-in-alt"></i> Rejoindre une Équipe
                        </button>
                        <button class="btn-outline" onclick="window.location.href='#tournois'" style="padding: 18px 45px; font-size: 18px;">
                            <i class="fas fa-trophy"></i> Rejoindre Tournois
                        </button>
                    {% endif %}
                </div>

                <!-- Hero Features -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; max-width: 1200px; margin: 0 auto;">
                    <div style="text-align: center; padding: 30px 20px; background: var(--card-bg); border-radius: 20px; border: 2px solid rgba(0, 217, 255, 0.1); transition: var(--transition);" class="hover-lift">
                        <div style="width: 70px; height: 70px; margin: 0 auto 20px; border-radius: 16px; background: rgba(0, 217, 255, 0.1); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-users" style="font-size: 36px; color: var(--primary-blue);"></i>
                        </div>
                        <h3 style="font-family: 'Orbitron', sans-serif; font-size: 20px; margin-bottom: 12px;">
                            Équipes Compétitives
                        </h3>
                        <p style="color: var(--text-secondary); line-height: 1.6; font-size: 15px;">
                            Rejoignez des équipes et participez à des compétitions de haut niveau
                        </p>
                    </div>

                    <div style="text-align: center; padding: 30px 20px; background: var(--card-bg); border-radius: 20px; border: 2px solid rgba(255, 0, 110, 0.1); transition: var(--transition);" class="hover-lift">
                        <div style="width: 70px; height: 70px; margin: 0 auto 20px; border-radius: 16px; background: rgba(255, 0, 110, 0.1); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-trophy" style="font-size: 36px; color: var(--primary-pink);"></i>
                        </div>
                        <h3 style="font-family: 'Orbitron', sans-serif; font-size: 20px; margin-bottom: 12px;">
                            Tournois Épiques
                        </h3>
                        <p style="color: var(--text-secondary); line-height: 1.6; font-size: 15px;">
                            Affrontez les meilleurs joueurs dans des tournois avec des récompenses incroyables
                        </p>
                    </div>

                    <div style="text-align: center; padding: 30px 20px; background: var(--card-bg); border-radius: 20px; border: 2px solid rgba(123, 47, 255, 0.1); transition: var(--transition);" class="hover-lift">
                        <div style="width: 70px; height: 70px; margin: 0 auto 20px; border-radius: 16px; background: rgba(123, 47, 255, 0.1); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-comments" style="font-size: 36px; color: var(--primary-purple);"></i>
                        </div>
                        <h3 style="font-family: 'Orbitron', sans-serif; font-size: 20px; margin-bottom: 12px;">
                            Communauté Active
                        </h3>
                        <p style="color: var(--text-secondary); line-height: 1.6; font-size: 15px;">
                            Connectez-vous avec plus de 21K joueurs passionnés du monde entier
                        </p>
                    </div>

                    <div style="text-align: center; padding: 30px 20px; background: var(--card-bg); border-radius: 20px; border: 2px solid rgba(0, 255, 136, 0.1); transition: var(--transition);" class="hover-lift">
                        <div style="width: 70px; height: 70px; margin: 0 auto 20px; border-radius: 16px; background: rgba(0, 255, 136, 0.1); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-shopping-cart" style="font-size: 36px; color: var(--success-color);"></i>
                        </div>
                        <h3 style="font-family: 'Orbitron', sans-serif; font-size: 20px; margin-bottom: 12px;">
                            Boutique Premium
                        </h3>
                        <p style="color: var(--text-secondary); line-height: 1.6; font-size: 15px;">
                            Accédez à des packs exclusifs et boostez votre progression
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters Section -->
        <div class="filters-section animate__animated animate__fadeInUp">
            <form class="filters-form">
                <div class="filters-row">
                    <div class="filter-group">
                        <label class="filter-label">
                            <i class="fas fa-search"></i> Rechercher
                        </label>
                        <input type="text" name="search" class="filter-input" 
                               placeholder="Nom d'équipe...">
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">
                            <i class="fas fa-medal"></i> Classement
                        </label>
                        <select name="classement" class="filter-select">
                            <option value="">Tous</option>
                            <option value="Bronze">Bronze</option>
                            <option value="Argent">Argent</option>
                            <option value="Or">Or</option>
                            <option value="Platine">Platine</option>
                            <option value="Diamant">Diamant</option>
                            <option value="Master">Master</option>
                            <option value="Challenger">Challenger</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">
                            <i class="fas fa-sort"></i> Trier
                        </label>
                        <select name="sort" class="filter-select">
                            <option value="recent">Plus récentes</option>
                            <option value="oldest">Plus anciennes</option>
                            <option value="name">Nom (A-Z)</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <button type="submit" class="btn-filter">
                            <i class="fas fa-filter"></i> Filtrer
                        </button>
                    </div>

                    <div class="filter-group">
                        <button type="reset" class="btn-filter btn-reset">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- SECTION 1: Équipes VEDETTES -->
        <div style="margin-bottom: 80px;">
            <h2 class="section-title" style="margin-bottom: 40px;">
                <i class="fas fa-star"></i> Équipes VEDETTES
            </h2>
            
            <div class="partners-grid">
                {% for team in featuredTeams %}
                <div class="partner-card animate__animated animate__fadeInUp" style="animation-delay: {{ loop.index * 0.1 }}s">
                    <div class="partner-image">
                        {% if team.logo %}
                            <img src="{{ asset('uploads/equipes/' ~ team.logo) }}" alt="{{ team.nomEquipe }}">
                        {% else %}
                            <img src="{{ asset('images/logo3.png') }}" alt="{{ team.nomEquipe }}">
                        {% endif %}
                    </div>
                    <div class="partner-info">
                        <h3 class="partner-name">{{ team.nomEquipe }}</h3>
                        <div style="text-align: center; margin-bottom: 15px;">
                            <span class="badge badge-primary">
                                <i class="fas fa-trophy"></i> {{ team.classement }}
                            </span>
                        </div>
                        <p class="partner-description">
                            {{ team.description|slice(0, 80) }}...
                        </p>
                        <div class="partner-stats">
                            <span class="partner-stat">
                                <i class="fas fa-calendar"></i> {{ team.dateCreation|date('d/m/Y') }}
                            </span>
                            <span class="partner-stat">
                                <i class="fas fa-tags"></i> {{ team.tag }}
                            </span>
                        </div>
                        <div class="partner-actions" style="display: flex; gap: 10px;">
                            <a href="{{ path('app_equipes_show', {'id': team.id}) }}" class="btn-partner" style="flex: 1; text-decoration: none; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                                <i class="fas fa-eye"></i> Détails
                            </a>
                            <a href="{{ path('app_equipes_apply', {'id': team.id}) }}" class="btn-gradient" style="flex: 1; text-decoration: none; padding: 10px; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 5px; border-radius: 8px;">
                                <i class="fas fa-paper-plane"></i> Postuler
                            </a>
                        </div>
                    </div>
                </div>
                {% else %}
                <div style="grid-column: 1 / -1; text-align: center; color: var(--text-secondary);">
                    <p>Aucune équipe vedette pour le moment.</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- SECTION 2: MON ÉQUIPE (CONSULTATION UNIQUEMENT) -->
        <div style="margin-bottom: 80px;">
            <h2 class="section-title" style="margin-bottom: 20px;">
                <i class="fas fa-user-shield"></i> MON ÉQUIPE
            </h2>
            <p class="section-subtitle">
                Consultez votre équipe actuelle
            </p>

            <div id="my-team-container">
                {% if myTeam %}
                <!-- CAS 2: Le joueur A une équipe (Réel, rendu par Twig Server-Side) -->
                <div id="has-team-state" style="display: block;">
                    <div class="partners-grid" style="max-width: 450px; margin: 0 auto;">
                        <div class="partner-card featured animate__animated animate__fadeInUp">
                            <div class="partner-badge">
                                <i class="fas fa-crown"></i> MON ÉQUIPE
                            </div>
                            <div class="partner-image">
                                <img src="{{ myTeam.logo ? asset('uploads/equipes/' ~ myTeam.logo) : asset('images/logo3.png') }}" alt="{{ myTeam.nomEquipe }}">
                            </div>
                            <div class="partner-info">
                                <h3 class="partner-name">{{ myTeam.nomEquipe }}</h3>
                                <div style="text-align: center; margin-bottom: 15px;">
                                    <span class="badge badge-primary">
                                        <i class="fas fa-medal"></i> {{ myTeam.classement }}
                                    </span>
                                </div>
                                <p class="partner-description">
                                    {{ myTeam.description ? myTeam.description|slice(0, 80) ~ '...' : 'Aucune description' }}
                                </p>
                                <div class="partner-stats">
                                    <span class="partner-stat">
                                        <i class="fas fa-calendar"></i> {{ myTeam.dateCreation|date('d/m/Y') }}
                                    </span>
                                    <span class="partner-stat">
                                        <i class="fas fa-user-friends"></i> {{ myTeam.recrutements|length }} Demande(s)
                                    </span>
                                </div>
                                <div class="partner-actions" style="display: flex; flex-direction: column; gap: 10px;">
                                    <a href="{{ path('app_equipes_show', {'id': myTeam.id}) }}" class="btn-partner" style="width: 100%; text-decoration: none; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-eye" style="margin-right: 8px;"></i> Voir Détails
                                    </a>
                                    
                                    {% if isManager|default(false) %}
                                        <div style="display: flex; gap: 10px; width: 100%;">
                                            <a href="{{ path('app_recrutements_manage', {'id': myTeam.id}) }}" class="btn-gradient" style="flex: 1; padding: 10px; text-decoration: none; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 5px;">
                                                <i class="fas fa-user-plus"></i> Gérer
                                            </a>
                                            <a href="{{ path('app_equipes_edit', {'id': myTeam.id}) }}" class="btn-outline" style="flex: 1; padding: 10px; text-decoration: none; font-size: 13px; border: 1px solid #FFC107; color: #FFC107; display: flex; align-items: center; justify-content: center; gap: 5px;">
                                                <i class="fas fa-edit"></i> Modifier
                                            </a>
                                        </div>
                                        <form method="post" action="{{ path('app_equipes_delete', {'id': myTeam.id}) }}" onsubmit="return confirm('Êtes-vous sûr ?');" style="width: 100%;">
                                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ myTeam.id) }}">
                                            <button class="btn-outline" style="width: 100%; padding: 10px; border: 1px solid var(--primary-pink); color: var(--primary-pink); background: none; cursor: pointer; font-family: inherit; font-size: 13px;">
                                                <i class="fas fa-trash-alt"></i> Supprimer l'Équipe
                                            </button>
                                        </form>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                <!-- CAS 1: Le joueur N'A PAS d'équipe -->
                <div id="no-team-state" style="display: block;">
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-users-slash"></i>
                        </div>
                        <h3 class="empty-title">Vous n'avez pas encore d'équipe</h3>
                        <p class="empty-text">
                            Rejoignez une équipe existante pour commencer votre aventure e-sport
                        </p>
                        <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px; flex-wrap: wrap;">
                            <button class="btn-gradient" onclick="showJoinTeamModal()" style="padding: 16px 35px; font-size: 16px; font-weight: 600; border-radius: 12px; text-transform: uppercase; letter-spacing: 1px;">
                                <i class="fas fa-sign-in-alt"></i> Rejoindre une Équipe
                            </button>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- SECTION: FIL D'ACTUALITÉ -->
        <div style="margin-bottom: 80px;">
            <h2 class="section-title" style="margin-bottom: 20px;">
                <i class="fas fa-newspaper"></i> FIL D'ACTUALITÉ
            </h2>
            <p class="section-subtitle">
                Les dernières news de la communauté E-Sportify
            </p>
            
            <!-- News Banner Slider -->
            <div class="info-card" style="overflow: hidden; position: relative; padding: 20px;">
                <div id="news-ticker" style="display: flex; gap: 60px; animation: ticker 25s linear infinite; white-space: nowrap;">
                    <div class="news-item" style="display: flex; align-items: center; gap: 15px;">
                        <span class="badge badge-success"><i class="fas fa-trophy"></i> TOURNOI</span>
                        <span style="color: var(--text-primary); font-weight: 600;">Le Tournoi Winter Cup 2025 commence le 15 Février !</span>
                    </div>
                    <div class="news-item" style="display: flex; align-items: center; gap: 15px;">
                        <span class="badge badge-primary"><i class="fas fa-users"></i> ÉQUIPE</span>
                        <span style="color: var(--text-primary); font-weight: 600;">Blaze Esports remporte le championnat régional</span>
                    </div>
                    <div class="news-item" style="display: flex; align-items: center; gap: 15px;">
                        <span class="badge" style="background: var(--warning-color); border: none;"><i class="fas fa-gift"></i> PROMO</span>
                        <span style="color: var(--text-primary); font-weight: 600;">-30% sur tous les packs premium cette semaine !</span>
                    </div>
                    <div class="news-item" style="display: flex; align-items: center; gap: 15px;">
                        <span class="badge badge-primary"><i class="fas fa-star"></i> NOUVEAU</span>
                        <span style="color: var(--text-primary); font-weight: 600;">Nouveau système de classement disponible</span>
                    </div>
                    <!-- Duplicate for infinite scroll -->
                    <div class="news-item" style="display: flex; align-items: center; gap: 15px;">
                        <span class="badge badge-success"><i class="fas fa-trophy"></i> TOURNOI</span>
                        <span style="color: var(--text-primary); font-weight: 600;">Le Tournoi Winter Cup 2025 commence le 15 Février !</span>
                    </div>
                    <div class="news-item" style="display: flex; align-items: center; gap: 15px;">
                        <span class="badge badge-primary"><i class="fas fa-users"></i> ÉQUIPE</span>
                        <span style="color: var(--text-primary); font-weight: 600;">Blaze Esports remporte le championnat régional</span>
                    </div>
                    <div class="news-item" style="display: flex; align-items: center; gap: 15px;">
                        <span class="badge" style="background: var(--warning-color); border: none;"><i class="fas fa-gift"></i> PROMO</span>
                        <span style="color: var(--text-primary); font-weight: 600;">-30% sur tous les packs premium cette semaine !</span>
                    </div>
                    <div class="news-item" style="display: flex; align-items: center; gap: 15px;">
                        <span class="badge badge-primary"><i class="fas fa-star"></i> NOUVEAU</span>
                        <span style="color: var(--text-primary); font-weight: 600;">Nouveau système de classement disponible</span>
                    </div>
                </div>
            </div>
        </div>

        <style>
            @keyframes ticker {
                0% { transform: translateX(0); }
                100% { transform: translateX(-50%); }
            }
            #news-ticker:hover {
                animation-play-state: paused;
            }
        </style>


        <!-- SECTION 4: BOUTIQUE -->
        <div style="margin-bottom: 80px;">
            <h2 class="section-title" style="margin-bottom: 20px;">
                <i class="fas fa-shopping-cart"></i> BOUTIQUE E-SPORT
            </h2>
            <p class="section-subtitle">
                Découvrez nos articles exclusifs pour booster votre expérience gaming
            </p>

            <div class="partners-grid">
                {% for product in products %}
                <div class="card animate__animated animate__fadeInUp" style="overflow: hidden; animation-delay: {{ loop.index * 0.1 }}s">
                    <div style="height: 200px; background: #0c0f1d; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden;">
                        {% if product.image %}
                            <img src="{{ product.image starts with 'http' ? product.image : asset(product.image) }}" alt="{{ product.nom }}" style="width: 100%; height: 100%; object-fit: cover;">
                        {% else %}
                            <i class="fas fa-box" style="font-size: 80px; color: rgba(255, 255, 255, 0.1);"></i>
                        {% endif %}
                        {% if product.stock == 0 %}
                            <span class="badge badge-danger" style="position: absolute; top: 15px; right: 15px; font-size: 13px;">
                                RUPTURE
                            </span>
                        {% endif %}
                    </div>
                    <div style="padding: 20px;">
                        <div style="color: var(--primary-pink); font-size: 11px; font-weight: 700; text-transform: uppercase; margin-bottom: 5px;">{{ product.categorie ? product.categorie.nom : 'DIVERS' }}</div>
                        <h3 style="font-family: 'Orbitron', sans-serif; font-size: 18px; margin-bottom: 10px;">
                            {{ product.nom }}
                        </h3>
                        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 15px; height: 40px; overflow: hidden;">
                            {{ product.description|slice(0, 60) }}...
                        </p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <span style="font-size: 24px; font-weight: 900; color: #fff; font-family: 'Orbitron', sans-serif;">{{ product.prix|number_format(0) }}€</span>
                            </div>
                            <a href="{{ path('app_front_produit_show', {id: product.id}) }}" class="btn-gradient" style="padding: 10px 20px; text-decoration: none;">
                                <i class="fas fa-eye"></i>
                            </a>
                        </div>
                    </div>
                </div>
                {% else %}
                <div style="grid-column: 1 / -1; text-align: center; color: var(--text-secondary); padding: 40px;">
                    <p>Aucun produit disponible pour le moment.</p>
                </div>
                {% endfor %}
            </div>

            <!-- View All Button -->
            <div style="text-align: center; margin-top: 40px;">
                <button class="btn-outline" style="padding: 16px 40px;" onclick="window.location.href='{{ path('app_front_produit_index') }}'">
                    <i class="fas fa-store"></i> Voir Toute la Boutique
                </button>
            </div>
        </div>

        <!-- CTA Section -->
        <section class="cta-section" style="margin-top: 60px;">
            <h2 class="cta-title">Rejoignez la Communauté E-Sport</h2>
            <p class="cta-text">
                Connectez-vous avec d'autres joueurs et développez votre équipe
            </p>
            <button class="btn-cta" onclick="window.location.href='#'">
                <i class="fas fa-rocket"></i> EXPLORER LES TOURNOIS
            </button>
        </section>

        <!-- Join Team Modal -->
        <div id="join-team-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 9999; overflow-y: auto; padding: 40px 20px;">
            <div style="max-width: 900px; margin: 0 auto; background: var(--card-bg); border-radius: var(--radius-xl); padding: 40px; border: 2px solid var(--primary-blue); position: relative;">
                <!-- Close Button -->
                <button onclick="closeJoinTeamModal()" style="position: absolute; top: 20px; right: 20px; background: transparent; border: 2px solid var(--primary-pink); color: var(--primary-pink); width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; transition: var(--transition);">
                    <i class="fas fa-times"></i>
                </button>

                <!-- Modal Header -->
                <h2 style="font-family: 'Orbitron', sans-serif; font-size: 32px; margin-bottom: 10px; color: var(--primary-blue);">
                    <i class="fas fa-sign-in-alt"></i> REJOINDRE UNE ÉQUIPE
                </h2>
                <p style="color: var(--text-secondary); margin-bottom: 40px; font-size: 16px;">
                    Recherchez une équipe et postulez pour les rejoindre
                </p>

                <!-- Search Bar -->
                <div style="margin-bottom: 30px;">
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="team-search" placeholder="Rechercher une équipe..." 
                               style="flex: 1; padding: 15px; border-radius: var(--radius-md); border: 2px solid rgba(0, 217, 255, 0.2); background: var(--darker-bg); color: var(--text-primary); font-family: 'Rajdhani', sans-serif; font-size: 15px;">
                        <button class="btn-gradient" onclick="searchTeams()" style="padding: 15px 30px;">
                            <i class="fas fa-search"></i> Rechercher
                        </button>
                    </div>
                </div>

                <!-- Available Teams List -->
                <div id="available-teams" style="display: grid; gap: 20px;">
                    {% for team in featuredTeams %}
                    <div class="card animate__animated animate__fadeIn" style="padding: 25px;">
                        <div style="display: flex; gap: 20px; align-items: start;">
                            <img src="{{ team.logo ? asset('uploads/equipes/' ~ team.logo) : asset('images/logo3.png') }}" alt="{{ team.nomEquipe }}" 
                                 style="width: 80px; height: 80px; border-radius: 16px; border: 3px solid var(--primary-blue); object-fit: cover; flex-shrink: 0;">
                            <div style="flex: 1;">
                                <h3 style="font-family: 'Orbitron', sans-serif; font-size: 22px; margin-bottom: 8px;">
                                    {{ team.nomEquipe }}
                                </h3>
                                <div style="display: flex; gap: 10px; margin-bottom: 12px; flex-wrap: wrap;">
                                    <span class="badge badge-primary">
                                        <i class="fas fa-medal"></i> {{ team.classement }}
                                    </span>
                                    <span class="badge badge-success">
                                        <i class="fas fa-door-open"></i> RECRUTEMENT OUVERT
                                    </span>
                                </div>
                                <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 15px;">
                                    {{ team.description|slice(0, 100) }}...
                                </p>
                                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                    <button class="btn-gradient" onclick="applyToTeam({{ team.id }}, '{{ team.nomEquipe|e('js') }}')" style="padding: 12px 24px;">
                                        <i class="fas fa-paper-plane"></i> Postuler
                                    </button>
                                    <button class="btn-outline" onclick="window.location.href='{{ path('app_equipes_show', {'id': team.id}) }}'" style="padding: 12px 24px;">
                                        <i class="fas fa-eye"></i> Voir Détails
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-search" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                        <p>Aucune équipe en vedette pour le moment. Utilisez la recherche pour trouver une équipe.</p>
                    </div>
                    {% endfor %}
                </div>

                <!-- No Results State -->
                <div id="no-teams-found" style="display: none; text-align: center; padding: 60px 20px;">
                    <i class="fas fa-search" style="font-size: 80px; color: var(--text-secondary); margin-bottom: 20px; opacity: 0.5;"></i>
                    <h3 style="color: var(--text-secondary); font-size: 20px;">Aucune équipe trouvée</h3>
                    <p style="color: var(--text-secondary); margin-top: 10px;">Essayez une autre recherche</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer" style="margin-left: 0; margin-top: 60px;">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Navigation</h3>
                    <ul>
                        <li><a href="{{ path('app_home') }}">Accueil</a></li>
                        <li><a href="#">Tournois</a></li>
                        <li><a href="{{ path('app_equipes_index') }}">Équipes</a></li>
                        <li><a href="#">Recrutement</a></li>
                        <li><a href="#">Shop</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>Support</h3>
                    <ul>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Contact</a></li>
                        <li><a href="#">Règlement</a></li>
                        <li><a href="#">Conditions d'utilisation</a></li>
                        <li><a href="#">Politique de confidentialité</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>Newsletter</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        Inscrivez-vous pour recevoir les dernières actualités
                    </p>
                    <form style="display: flex; gap: 10px;">
                        <input type="email" placeholder="Votre email" 
                               style="flex: 1; padding: 12px; border-radius: 8px; border: 2px solid var(--primary-blue); 
                                      background: var(--card-bg); color: var(--text-primary);">
                        <button type="submit" 
                                style="padding: 12px 24px; border-radius: 8px; border: none; 
                                       background: var(--gradient-1); color: white; cursor: pointer; font-weight: 700;">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </form>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 ESportify. Tous droits réservés. Développé avec amour pour la communauté e-sport.</p>
            </div>
        </footer>
    </main>

    <!-- JavaScript -->
    <script src="{{ asset('js/app.js') }}"></script>
    <script>
        // Variable globale pour stocker l'ID de l'équipe du joueur
        window.myTeamId = null;
        {% if app.session.get('my_team_id') %}
            window.serverTeamId = {{ app.session.get('my_team_id') }};
        {% else %}
            window.serverTeamId = null;
        {% endif %}

        // Affiche un message lorsque l'utilisateur demande à voir son équipe mais qu'il n'en a pas
        function showNoTeamAlert() {
            alert("Vous n'avez pas encore d'équipe. Rejoignez une équipe pour commencer !");
        }

        // Navigate to a team safely
        function navigateToTeam(teamId) {
            if (!teamId) {
                showNoTeamAlert();
                return;
            }

            fetch('/equipe/' + teamId, { method: 'GET' })
                .then(response => {
                    if (response.ok) {
                        window.location.href = '/equipe/' + teamId;
                    } else {
                        showNoTeamAlert();
                    }
                })
                .catch(() => {
                    showNoTeamAlert();
                });
        }

        // Theme toggle
        const themeToggles = [document.getElementById('themeToggle'), document.getElementById('themeToggleTop')].filter(Boolean);
        const applyThemeLabels = (newTheme) => {
            themeToggles.forEach(btn => {
                const icon = btn.querySelector('i');
                const text = btn.querySelector('span');
                if (icon) icon.className = newTheme === 'light' ? 'fas fa-sun' : 'fas fa-moon';
                if (text) text.textContent = newTheme === 'light' ? 'Mode Jour' : 'Mode Nuit';
            });
        };
        if (themeToggles.length) {
            themeToggles.forEach(btn => {
                btn.addEventListener('click', () => {
                    const body = document.body;
                    const currentTheme = body.getAttribute('data-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    body.setAttribute('data-theme', newTheme);
                    applyThemeLabels(newTheme);
                });
            });
        }

        // JS supprimé car remplacé par Twig Server-Side Rendering
        // La logique d'affichage de l'équipe du manager est désormais gérée par le contrôleur et Twig.



        // ===== JOIN TEAM FUNCTIONS =====
        function showJoinTeamModal() {
            document.getElementById('join-team-modal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeJoinTeamModal() {
            document.getElementById('join-team-modal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function searchTeams() {
            const searchInput = document.getElementById('team-search');
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            const availableTeams = document.getElementById('available-teams');
            const noTeamsFound = document.getElementById('no-teams-found');
            const teamCards = availableTeams.querySelectorAll('.card');
            
            let visibleCount = 0;
            
            teamCards.forEach(card => {
                const teamName = card.querySelector('h3').textContent.toLowerCase();
                if (searchTerm === '' || teamName.includes(searchTerm)) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            if (visibleCount === 0) {
                availableTeams.style.display = 'none';
                noTeamsFound.style.display = 'block';
            } else {
                availableTeams.style.display = 'grid';
                noTeamsFound.style.display = 'none';
            }
        }

        function applyToTeam(teamId, teamName) {
            if (confirm(`Envoyer votre candidature à l'équipe "${teamName}" ?\n\nVous pourrez ajouter une lettre de motivation sur la page suivante.`)) {
                window.location.href = `recrutements/new.html?team_id=${teamId}`;
            }
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeJoinTeamModal();
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            const teamSearch = document.getElementById('team-search');
            if (teamSearch) {
                teamSearch.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        searchTeams();
                    }
                });
            }
        });
    </script>

    <style>
        .cart-fab-home {
            position: fixed;
            bottom: 110px;
            right: 30px;
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-cyan));
            color: #fff;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 12px 28px rgba(67, 97, 238, 0.35);
            text-decoration: none;
            z-index: 1001;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .cart-fab-home:hover {
            transform: translateY(-2px);
            box-shadow: 0 16px 36px rgba(67, 97, 238, 0.45);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }


        .hover-lift {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
    </style>
    <!-- Dynamic Search Script -->
    <script>
        // Store the default static content to restore it if search is empty
        let defaultTeamsContent = '';
        
        document.addEventListener('DOMContentLoaded', function() {
             const container = document.getElementById('available-teams');
             if(container) {
                 defaultTeamsContent = container.innerHTML;
             }
             
             // Input event for real-time search
             const searchInput = document.getElementById('team-search');
             if(searchInput) {
                 searchInput.addEventListener('input', function(e) {
                     if(e.target.value.length === 0) {
                         // Restore default if empty
                         document.getElementById('available-teams').innerHTML = defaultTeamsContent;
                         document.getElementById('no-teams-found').style.display = 'none';
                     } else if(e.target.value.length > 2) {
                         // Trigger search if more than 2 chars
                         searchTeams();
                     }
                 });
             }
        });

        function searchTeams() {
            const query = document.getElementById('team-search').value;
            const resultsContainer = document.getElementById('available-teams');
            const noResults = document.getElementById('no-teams-found');
            
            if (!query) return;

            // Show loading state (optional visual improvement)
            resultsContainer.style.opacity = '0.5';

            fetch(`/equipe/api/search?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    resultsContainer.innerHTML = '';
                    resultsContainer.style.opacity = '1';
                    
                    if (data.length === 0) {
                        noResults.style.display = 'block';
                    } else {
                        noResults.style.display = 'none';
                        data.forEach(team => {
                            // Determine badge color based on rank
                            let badgeClass = 'badge-primary';
                            let icon = 'fa-medal';
                            if(team.rank === 'Challenger') { badgeClass = 'badge-danger'; icon = 'fa-trophy'; }
                            else if(team.rank === 'Diamant') { badgeClass = 'badge-info'; icon = 'fa-gem'; }
                            
                            // Construct Logo Path
                            const logoPath = team.logo 
                                ? `/uploads/equipes/${team.logo}`
                                : `/images/logo3.png`; // Fallback logo

                            const cardHtml = `
                            <div class="card animate__animated animate__fadeIn" style="padding: 25px;">
                                <div style="display: flex; gap: 20px; align-items: start;">
                                    <img src="${logoPath}" alt="${team.name}" 
                                         style="width: 80px; height: 80px; border-radius: 16px; border: 3px solid var(--primary-blue); object-fit: cover; flex-shrink: 0;">
                                    <div style="flex: 1;">
                                        <h3 style="font-family: 'Orbitron', sans-serif; font-size: 22px; margin-bottom: 8px;">
                                            ${team.name}
                                        </h3>
                                        <div style="display: flex; gap: 10px; margin-bottom: 12px; flex-wrap: wrap;">
                                            <span class="badge ${badgeClass}">
                                                <i class="fas ${icon}"></i> ${team.rank}
                                            </span>
                                            <span class="badge badge-success">
                                                <i class="fas fa-door-open"></i> RECRUTEMENT OUVERT
                                            </span>
                                            <span class="badge" style="background: rgba(0, 217, 255, 0.1); color: var(--primary-blue); border: 1px solid var(--primary-blue);">
                                                <i class="fas fa-flag"></i> ${team.region}
                                            </span>
                                        </div>
                                        <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 15px;">
                                            ${team.description}
                                        </p>
                                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                            <button class="btn-gradient" onclick="applyToTeam(${team.id}, '${team.name}')" style="padding: 12px 24px;">
                                                <i class="fas fa-paper-plane"></i> Postuler
                                            </button>
                                            <button class="btn-outline" onclick="window.location.href='/equipe/${team.id}'" style="padding: 12px 24px;">
                                                <i class="fas fa-eye"></i> Voir Détails
                                            </button>
                        </div>
                                    </div>
                                </div>
                            </div>
                            `;
                            resultsContainer.innerHTML += cardHtml;
                        });
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    resultsContainer.style.opacity = '1';
                });
        }
        
        function applyToTeam(id, name) {
            // Redirection directe vers le formulaire
            window.location.href = '/equipe/' + id + '/postuler';
        }
    </script>
</body>
</html>
