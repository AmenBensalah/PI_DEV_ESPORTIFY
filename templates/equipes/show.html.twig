{% extends 'base.html.twig' %}

{% block body_class %}page-equipes{% endblock %}

{% block title %}{{ equipe.nomEquipe }} - E-Sportify{% endblock %}

{% block body %}
<div class="equipes-content equipe-detail">
    <div class="flash-messages-container">
        {% for message in app.flashes('success') %}
            <div class="flash-success" role="status" aria-live="polite" style="margin:12px 0;">
                <i class="fas fa-check-circle" style="color: var(--success-color); font-size: 18px; margin-right:10px;"></i>
                <span style="color: var(--success-color); font-weight:600;">{{ message }}</span>
            </div>
        {% endfor %}
        {% for message in app.flashes('error') %}
            <div class="flash-error" role="status" aria-live="polite" style="margin:12px 0; background: rgba(255,0,110,0.06); border:1px solid var(--primary-pink); padding:10px 12px; border-radius:8px;">
                <i class="fas fa-exclamation-circle" style="color: var(--primary-pink); font-size: 18px; margin-right:10px;"></i>
                <span style="color: var(--primary-pink); font-weight:600;">{{ message }}</span>
            </div>
        {% endfor %}
    </div>

    <section class="team-cover" style="--cover-image: url('{{ asset('images/gaming1.jpg') }}');">
        <div class="team-cover-inner">
            <div class="team-cover-logo">
                {% if equipe.logo %}
                    <img src="{{ asset('uploads/equipes/' ~ equipe.logo) }}" alt="{{ equipe.nomEquipe }}">
                {% else %}
                    <div class="team-cover-placeholder">
                        <i class="fas fa-users"></i>
                    </div>
                {% endif %}
            </div>
            <div class="team-cover-content">
                <span class="badge badge-info"><i class="fas fa-medal"></i> {{ (equipe.classement|default('Non classé'))|upper }}</span>
                <h1 class="team-cover-title">{{ equipe.nomEquipe }}</h1>
                <p class="team-description">{{ equipe.description|default('Aucune description disponible pour le moment.') }}</p>
                <div class="team-cover-actions">
                    {% if isMember %}
                        <span class="badge badge-success"><i class="fas fa-check-circle"></i> Membre officiel</span>
                        <form method="post" action="{{ path('app_equipes_leave', {'id': equipe.id}) }}" onsubmit="return confirm('Confirmer la sortie de l\\'équipe ?');" style="display:inline;">
                            <input type="hidden" name="_token" value="{{ csrf_token('leave' ~ equipe.id) }}">
                            <button type="submit" class="btn-outline">
                                <i class="fas fa-sign-out-alt"></i> Quitter l'équipe
                            </button>
                        </form>
                    {% endif %}

                    {% if canJoinTeam and not isMember %}
                        <a href="{{ path('app_equipes_apply', {'id': equipe.id}) }}" class="btn-gradient">
                            <i class="fas fa-paper-plane"></i> Postuler
                        </a>
                    {% endif %}

                    {% if isManager %}
                        <a href="{{ path('app_equipes_edit', {'id': equipe.id}) }}" class="btn-outline">
                            <i class="fas fa-edit"></i> Modifier
                        </a>
                        <a href="{{ path('app_recrutements_manage', {'id': equipe.id}) }}" class="btn-gradient">
                            <i class="fas fa-user-plus"></i> Gérer demandes
                        </a>
                        <form method="post" action="{{ path('app_equipes_delete', {'id': equipe.id}) }}" onsubmit="return confirm('Supprimer l\\'équipe définitivement ?');" style="display:inline;">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ equipe.id) }}">
                            <button type="submit" class="btn-outline">
                                <i class="fas fa-trash-alt"></i> Supprimer l'équipe
                            </button>
                        </form>
                    {% endif %}

                    <a href="{{ path('app_equipes_index') }}" class="btn-outline">
                        <i class="fas fa-arrow-left"></i> Retour au hub
                    </a>
                </div>
            </div>
        </div>
    </section>

    {% set membersCount = members|length + (equipe.manager ? 1 : 0) %}
    <section class="team-stats-grid">
        <div class="team-stat-card">
            <div class="team-stat-value">{{ membersCount }}</div>
            <div class="team-stat-label">Membres</div>
        </div>
        <div class="team-stat-card">
            <div class="team-stat-value">{{ equipe.recrutements|length }}</div>
            <div class="team-stat-label">Recrutements</div>
        </div>
        <div class="team-stat-card">
            <div class="team-stat-value">{{ equipe.region ?: 'Global' }}</div>
            <div class="team-stat-label">Région</div>
        </div>
        <div class="team-stat-card">
            <div class="team-stat-value">{{ equipe.dateCreation|date('d/m/Y') }}</div>
            <div class="team-stat-label">Création</div>
        </div>
    </section>

    <section class="team-roster">
        <div class="team-roster-header">
            <h2>Roster</h2>
            <p class="team-description">Liste des membres actifs de l'équipe.</p>
        </div>
        <div class="admin-tournament-table">
            <table>
                <thead>
                    <tr>
                        <th>Joueur</th>
                        <th>Rôle</th>
                        <th>Date d'entrée</th>
                        <th>Profil</th>
                        {% if isManager %}
                            <th>Action</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% if equipe.manager %}
                        <tr>
                            <td>{{ equipe.manager.pseudo ?? equipe.manager.email ?? 'Manager' }}</td>
                            <td><span class="badge badge-info">Manager</span></td>
                            <td>{{ equipe.dateCreation|date('d/m/Y') }}</td>
                            <td><a href="#" class="admin-tournament-btn ghost">Profil</a></td>
                            {% if isManager %}
                                <td>-</td>
                            {% endif %}
                        </tr>
                    {% endif %}
                    {% for member in members %}
                        <tr>
                            <td>{{ member.pseudo ?? member.nom }}</td>
                            <td><span class="badge badge-success">Membre</span></td>
                            <td>{{ member.date ?: '-' }}</td>
                            <td><a href="#" class="admin-tournament-btn ghost">Profil</a></td>
                            {% if isManager %}
                                <td>
                                    <form method="post" action="{{ path('app_equipes_remove_member', {'id': equipe.id}) }}" onsubmit="return confirm('Voulez-vous vraiment retirer ce membre ?');">
                                        <input type="hidden" name="user_id" value="{{ member.id }}">
                                        <button type="submit" class="admin-tournament-btn danger">Exclure</button>
                                    </form>
                                </td>
                            {% endif %}
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="4">Aucun membre supplémentaire pour l'instant.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
</div>
{% endblock %}
