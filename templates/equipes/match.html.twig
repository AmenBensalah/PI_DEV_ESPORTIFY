{% extends 'base.html.twig' %}

{% block body_class %}page-equipes{% endblock %}

{% block title %}Matching Equipes IA - E-Sportify{% endblock %}

{% block body %}
<div class="equipes-content equipes-hub">
    <section class="admin-tournament-hero">
        <div class="admin-tournament-hero-inner">
            <div class="admin-tournament-kicker">IA Matching</div>
            <h2 class="admin-tournament-title">Trouver l'equipe ideale</h2>
            <p class="admin-tournament-lead">Pourcentage de compatibilite par equipe + explication locale.</p>
        </div>
        <div class="admin-tournament-hero-glow"></div>
    </section>

    <section class="admin-tournament-panel" style="margin-top: 18px;">
        <div class="admin-tournament-panel-title">
            <i class="fas fa-wand-magic-sparkles"></i>
            Preferences du joueur
        </div>
        <form method="post" class="admin-tournament-form">
            <div class="field">
                <label>Niveau</label>
                <select name="niveau">
                    <option value="">-- Choisir --</option>
                    {% for lvl in ['Debutant', 'Intermediaire', 'Confirme', 'Expert'] %}
                        <option value="{{ lvl }}" {% if prefs.niveau == lvl %}selected{% endif %}>{{ lvl }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="field">
                <label>Region</label>
                <select name="region">
                    <option value="">-- Toutes --</option>
                    {% for reg in ['Africa', 'Asia', 'Europe', 'Middle East', 'North America', 'South America', 'Oceania'] %}
                        <option value="{{ reg }}" {% if prefs.region == reg %}selected{% endif %}>{{ reg }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="field">
                <label>Jeu principal</label>
                <input type="text" name="game" placeholder="ex: Valorant, LoL" value="{{ prefs.game }}">
            </div>
            <div class="field">
                <label>Style de jeu</label>
                <input type="text" name="play_style" placeholder="ex: agressif, support" value="{{ prefs.play_style }}">
            </div>
            <div class="field" style="grid-column: 1 / -1;">
                <label>Objectifs</label>
                <input type="text" name="goals" placeholder="ex: competition, fun, entrainement" value="{{ prefs.goals }}">
            </div>
            <div class="admin-tournament-actions">
                <button type="submit" class="admin-tournament-btn">
                    <i class="fas fa-wand-magic-sparkles"></i> Lancer le matching
                </button>
                <a href="{{ path('app_equipes_index') }}" class="admin-tournament-btn ghost">
                    <i class="fas fa-arrow-left"></i> Retour equipes
                </a>
            </div>
        </form>
    </section>

    {% if ranked is not empty %}
        <section class="admin-tournament-table" style="margin-top: 20px;">
            <table>
                <thead>
                    <tr>
                        <th>Equipe</th>
                        <th>Compatibilite</th>
                        <th>Raisons (local)</th>
                        <th>Explication</th>
                        <th>Profil</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in ranked|slice(0, 8) %}
                        {% set team = item.team %}
                        <tr class="admin-tournament-row">
                            <td>
                                <div style="display:flex; align-items:center; gap:10px;">
                                    {% if team.logo %}
                                        <img src="{{ asset('uploads/equipes/' ~ team.logo) }}" alt="Logo" style="width: 32px; height: 32px; border-radius: 10px; object-fit: cover;">
                                    {% else %}
                                        <div class="avatar-circle" style="width: 32px; height: 32px; font-size: 12px;">{{ team.nomEquipe|first|upper }}</div>
                                    {% endif %}
                                    <div>
                                        <div style="font-weight: 600;">{{ team.nomEquipe }}</div>
                                        <small style="color: var(--text-secondary);">{{ team.region|default('-') }} - {{ team.classement|default('-') }}</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="badge badge-info">{{ item.compatibility|default(0) }}%</span>
                                <small style="display:block; color: var(--text-secondary); margin-top: 6px;">Score brut {{ item.score }}</small>
                            </td>
                            <td>
                                {% if item.reasons is empty %}
                                    <span class="badge badge-success">Neutre</span>
                                {% else %}
                                    {{ item.reasons|join(', ') }}
                                {% endif %}
                            </td>
                            <td>
                                {% if aiExplanations[team.id]|default('') %}
                                    {{ aiExplanations[team.id] }}
                                {% else %}
                                    <span style="color: var(--text-secondary);">{{ localExplanations[team.id]|default('Analyse locale indisponible.') }}</span>
                                {% endif %}
                            </td>
                            <td>
                                <a href="{{ path('app_equipes_show', {'id': team.id}) }}" class="admin-tournament-btn ghost">Voir</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
    {% elseif prefs.niveau or prefs.region or prefs.game or prefs.play_style or prefs.goals %}
        <div class="admin-tournament-empty">
            <div class="empty-ring"></div>
            <strong>Aucune equipe trouvee</strong>
            <p>Essayez d'ajuster vos preferences.</p>
        </div>
    {% endif %}
</div>
{% endblock %}

