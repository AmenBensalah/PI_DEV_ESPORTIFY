{% extends from == 'admin' ? 'admin/layout.html.twig' : 'base.html.twig' %}

{% block body_class %}page-equipes{% endblock %}

{% block title %}Modifier {{ equipe.nomEquipe }} — E-Sportify{% endblock %}
{% block page_title %}Modifier {{ equipe.nomEquipe }}{% endblock %}

{% block body %}
<div class="equipes-content">
    <div class="admin-form-wrapper">
        <div class="admin-form-card">
            <div class="admin-form-header">
                <div class="admin-form-icon">
                    <i class="fas fa-edit"></i>
                </div>
                <div>
                    <h1 class="admin-form-title">Modifier l'équipe</h1>
                    <p class="admin-form-subtitle">Mettez à jour les informations de {{ equipe.nomEquipe }}.</p>
                </div>
            </div>

            {% for message in app.flashes('error') %}
                <div class="flash-error" role="status" aria-live="polite" style="margin:12px 0; background: rgba(255,0,110,0.06); border:1px solid var(--primary-pink); padding:10px 12px; border-radius:8px;">
                    {{ message }}
                </div>
            {% endfor %}
            {% for message in app.flashes('success') %}
                <div class="flash-success" role="status" aria-live="polite" style="margin:12px 0;">
                    {{ message }}
                </div>
            {% endfor %}

            <form method="POST" action="{{ path('app_equipes_edit', {'id': equipe.id, 'from': from}) }}" enctype="multipart/form-data">
                <div class="admin-form-grid">
                    <div>
                        <div class="admin-form-group">
                            <label class="admin-form-label"><i class="fas fa-users"></i> Nom de l'équipe *</label>
                            <input type="text" name="equipe[nomEquipe]" class="admin-form-input" value="{{ equipe.nomEquipe }}">
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label"><i class="fas fa-tag"></i> Tag</label>
                            <input type="text" name="equipe[tag]" class="admin-form-input" value="{{ equipe.tag }}" placeholder="Ex: PHX">
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label"><i class="fas fa-medal"></i> Classement</label>
                            <select name="equipe[classement]" class="admin-form-select">
                                <option value="">Sélectionner...</option>
                                <option value="Bronze" {% if equipe.classement == 'Bronze' %}selected{% endif %}>Bronze</option>
                                <option value="Argent" {% if equipe.classement == 'Argent' %}selected{% endif %}>Argent</option>
                                <option value="Or" {% if equipe.classement == 'Or' %}selected{% endif %}>Or</option>
                                <option value="Platine" {% if equipe.classement == 'Platine' %}selected{% endif %}>Platine</option>
                                <option value="Diamant" {% if equipe.classement == 'Diamant' %}selected{% endif %}>Diamant</option>
                                <option value="Master" {% if equipe.classement == 'Master' %}selected{% endif %}>Master</option>
                                <option value="Challenger" {% if equipe.classement == 'Challenger' %}selected{% endif %}>Challenger</option>
                            </select>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label"><i class="fas fa-calendar-alt"></i> Date de création</label>
                            <input type="date" name="equipe[dateCreation]" class="admin-form-input" value="{{ equipe.dateCreation ? equipe.dateCreation|date('Y-m-d') : '' }}">
                        </div>
                    </div>

                    <div>
                        <div class="admin-form-group">
                            <label class="admin-form-label"><i class="fas fa-globe"></i> Région</label>
                            <select name="equipe[region]" class="admin-form-select">
                                <option value="">Sélectionner une région...</option>
                                <option value="Asia" {% if equipe.region == 'Asia' %}selected{% endif %}>Asia</option>
                                <option value="Europe" {% if equipe.region == 'Europe' %}selected{% endif %}>Europe</option>
                                <option value="Middle East" {% if equipe.region == 'Middle East' %}selected{% endif %}>Middle East</option>
                                <option value="North America" {% if equipe.region == 'North America' %}selected{% endif %}>North America</option>
                                <option value="South America" {% if equipe.region == 'South America' %}selected{% endif %}>South America</option>
                                <option value="Oceania" {% if equipe.region == 'Oceania' %}selected{% endif %}>Oceania</option>
                                <option value="Africa" {% if equipe.region == 'Africa' %}selected{% endif %}>Africa</option>
                            </select>
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label"><i class="fab fa-discord"></i> Lien Discord (membres)</label>
                            <input
                                type="url"
                                name="equipe[discordInviteUrl]"
                                class="admin-form-input"
                                value="{{ equipe.discordInviteUrl }}"
                                placeholder="https://discord.gg/xxxxxx">
                        </div>

                        <div class="admin-form-group">
                            <label class="admin-form-label"><i class="fas fa-image"></i> Logo de l'équipe</label>
                            <div class="admin-upload-box {{ equipe.logo ? 'has-preview' : '' }}" id="logoUploadBox">
                                <div class="admin-upload-preview {{ equipe.logo ? 'show' : '' }}" id="logoPreview">
                                    {% if equipe.logo %}
                                        <img src="{{ asset('uploads/equipes/' ~ equipe.logo) }}" alt="Logo actuel">
                                    {% endif %}
                                </div>
                                <div class="admin-upload-placeholder">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <span>Cliquez ou glissez une image ici</span>
                                    <small>PNG, JPG, GIF — max 5MB</small>
                                </div>
                                <input type="file" class="admin-upload-input" id="logoInput" name="equipe[logo]" accept="image/*" onchange="previewLogo(this)">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="admin-form-group">
                    <label class="admin-form-label"><i class="fas fa-align-left"></i> Description *</label>
                    <textarea name="equipe[description]" class="admin-form-textarea">{{ equipe.description }}</textarea>
                </div>

                <div class="admin-form-actions">
                    <a href="{{ from == 'admin' ? path('admin_equipes') : path('app_equipes_show', {'id': equipe.id}) }}" class="admin-form-cancel">
                        <i class="fas fa-times"></i> Annuler
                    </a>
                    <button type="submit" class="admin-form-submit">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function previewLogo(input) {
        const preview = document.getElementById('logoPreview');
        const box = document.getElementById('logoUploadBox');
        if (!preview || !input.files || !input.files[0]) return;

        const reader = new FileReader();
        reader.onload = function(event) {
            preview.innerHTML = `<img src="${event.target.result}" alt="Aperçu logo">`;
            preview.style.display = 'block';
            preview.classList.add('show');
            if (box) box.classList.add('has-preview');
        };
        reader.readAsDataURL(input.files[0]);
    }
</script>
{% endblock %}
