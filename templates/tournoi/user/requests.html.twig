{% extends 'base.html.twig' %}

{% block title %}Mes demandes{% endblock %}

{% block body %}
<section class="tournoi-hero">
    <div class="tournoi-hero-inner">
        <div class="tournoi-kicker">Requests</div>
        <h1 class="tournoi-title">Demandes de participation</h1>
        <p class="tournoi-lead">Suivi de tes demandes et statuts.</p>
        <div class="tournoi-hero-actions">
            <a href="{{ path('tournoi_index') }}" class="neo-btn ghost">Retour aux tournois</a>
        </div>
    </div>
    <div class="tournoi-hero-glow"></div>
</section>

<section class="tournoi-shell">
    {% if requests %}
        <div class="tournoi-grid">
            {% for r in requests %}
                <article class="tournoi-card">
                    <header>
                        <div class="name">{{ r.tournoi.name }}</div>
                        <div class="badges">
                            {% if r.status == 'en_attente' or r.status == 'pending' %}
                                <span class="badge info">En attente</span>
                            {% elseif r.status == 'approuvee' or r.status == 'approved' %}
                                <span class="badge success">Approuvee</span>
                            {% elseif r.status == 'rejetee' or r.status == 'rejected' %}
                                <span class="badge danger">Rejetee</span>
                            {% else %}
                                <span class="badge muted">{{ r.status }}</span>
                            {% endif %}
                        </div>
                    </header>

                    <div class="meta">
                        <div>
                            <span>Utilisateur</span>
                            <strong>
                                {% if r.user %}
                                    {{ r.user.pseudo ?: r.user.nom ?: r.user.email }}{% if r.user.email %} ({{ r.user.email }}){% endif %}
                                {% elseif r.applicantName or r.applicantEmail %}
                                    {{ r.applicantName|default('Anonyme') }}{% if r.applicantEmail %} ({{ r.applicantEmail }}){% endif %}
                                {% else %}
                                    Anonyme
                                {% endif %}
                            </strong>
                        </div>
                        <div>
                            <span>Cree le</span>
                            <strong>{{ r.createdAt|date('Y-m-d H:i') }}</strong>
                        </div>
                        <div>
                            <span>ID</span>
                            <strong>#{{ r.id }}</strong>
                        </div>
                    </div>

                    <div class="tournoi-message">{{ r.message }}</div>

                    <footer class="actions">
                        {% if r.status == 'en_attente' or r.status == 'pending' %}
                            <a href="{{ path('tournoi_participation_request_edit', {id: r.id}) }}" class="neo-btn">Modifier</a>
                            <form method="POST" action="{{ path('tournoi_participation_request_delete', {id: r.id}) }}">
                                <button type="submit" class="neo-btn ghost" onclick="return confirm('Supprimer cette demande ?')">Supprimer</button>
                            </form>
                        {% else %}
                            <span class="badge muted">-</span>
                        {% endif %}
                    </footer>
                </article>
            {% endfor %}
        </div>
    {% else %}
        <div class="tournoi-empty">
            <div class="empty-ring"></div>
            <strong>Aucune demande trouvee.</strong>
            <span>Tu peux postuler a un tournoi depuis la page Tournois.</span>
        </div>
    {% endif %}
</section>
{% endblock %}
