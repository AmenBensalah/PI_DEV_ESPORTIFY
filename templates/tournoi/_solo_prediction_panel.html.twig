{% if tournoi.typeTournoi == 'solo' %}
    {% set panelId = predictionPanelId|default('solo-prediction-body-' ~ (tournoi.idTournoi|default('solo'))) %}
    {% set showInternalToggle = showInternalToggle|default(true) %}

    <style>
        .solo-prediction-panel {
            margin-top: 16px;
            border-radius: 16px;
            border: 1px solid rgba(118, 189, 255, 0.35);
            background:
                radial-gradient(circle at top right, rgba(88, 255, 227, 0.14), transparent 44%),
                linear-gradient(150deg, rgba(9, 20, 42, 0.95), rgba(14, 30, 57, 0.86));
            box-shadow: 0 16px 34px rgba(4, 10, 25, 0.42);
            overflow: hidden;
        }

        .solo-prediction-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
            padding: 16px 16px 0;
        }

        .solo-prediction-title {
            margin: 0;
            color: #fff;
            font-size: 28px;
            font-weight: 800;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .solo-prediction-subtitle {
            margin: 6px 0 0;
            color: #b7c8df;
            font-size: 13px;
        }

        .solo-prediction-toggle {
            border: 1px solid rgba(132, 210, 255, 0.5);
            background: rgba(16, 39, 69, 0.75);
            color: #e9f5ff;
            border-radius: 10px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .solo-prediction-toggle:hover {
            background: rgba(26, 58, 98, 0.92);
        }

        .solo-prediction-body {
            padding: 14px 16px 16px;
        }

        .solo-prediction-body[hidden] {
            display: none !important;
        }

        .solo-prediction-grid {
            display: grid;
            grid-template-columns: minmax(280px, 330px) minmax(0, 1fr);
            gap: 12px;
        }

        .solo-prediction-card {
            border: 1px solid rgba(88, 255, 227, 0.4);
            border-radius: 14px;
            background: linear-gradient(160deg, rgba(8, 36, 47, 0.85), rgba(9, 23, 40, 0.75));
            padding: 14px;
        }

        .solo-prediction-kicker {
            text-transform: uppercase;
            letter-spacing: .7px;
            font-size: 11px;
            color: #86f8d8;
            font-weight: 700;
        }

        .solo-prediction-name {
            color: #fff;
            font-size: 24px;
            font-weight: 800;
            margin-top: 3px;
        }

        .solo-prediction-prob {
            color: #68ffcf;
            font-size: 34px;
            font-weight: 900;
            line-height: 1.1;
            margin-top: 2px;
            text-shadow: 0 0 24px rgba(104, 255, 207, 0.28);
        }

        .solo-prediction-chips {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .solo-prediction-chip {
            display: inline-flex;
            align-items: center;
            border: 1px solid rgba(151, 206, 255, 0.3);
            border-radius: 999px;
            padding: 5px 10px;
            color: #e8f3ff;
            background: rgba(14, 30, 57, 0.55);
            font-size: 12px;
            font-weight: 600;
        }

        .solo-prediction-chip.muted {
            color: #b5cde9;
            border-color: rgba(151, 206, 255, 0.2);
        }

        .solo-prediction-table-wrap {
            border: 1px solid rgba(122, 176, 239, 0.28);
            border-radius: 14px;
            background: rgba(8, 20, 43, 0.58);
            padding: 8px 10px;
            overflow-x: auto;
        }

        .solo-prediction-table {
            width: 100%;
            border-collapse: collapse;
        }

        .solo-prediction-table th,
        .solo-prediction-table td {
            padding: 12px 8px;
            text-align: left;
            color: #fff;
            border-bottom: 1px solid rgba(160, 195, 232, 0.14);
            font-size: 13px;
        }

        .solo-prediction-table th {
            color: #9ebce0;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: .5px;
            font-weight: 700;
        }

        .solo-prediction-table tr:last-child td {
            border-bottom: 0;
        }

        .solo-prediction-rank {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 7px;
            background: rgba(21, 47, 79, 0.9);
            border: 1px solid rgba(132, 201, 255, 0.36);
            font-weight: 700;
        }

        .solo-prediction-prob-cell {
            display: grid;
            grid-template-columns: 52px minmax(100px, 1fr);
            align-items: center;
            gap: 8px;
        }

        .solo-prediction-prob-bar {
            height: 8px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.12);
            overflow: hidden;
        }

        .solo-prediction-prob-bar > span {
            display: block;
            height: 100%;
            border-radius: inherit;
            background: linear-gradient(90deg, #4ac8ff, #49ffd0);
        }

        .solo-prediction-empty {
            border: 1px dashed rgba(138, 189, 245, 0.35);
            border-radius: 12px;
            padding: 12px;
            color: #d6e6fa;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(11, 27, 52, 0.45);
        }

        @media (max-width: 880px) {
            .solo-prediction-grid {
                grid-template-columns: 1fr;
            }

            .solo-prediction-top {
                flex-direction: column;
            }
        }
    </style>

    <article class="solo-prediction-panel" id="solo-prediction-panel-{{ tournoi.idTournoi|default('solo') }}">
        <div class="solo-prediction-top">
            <div>
                <h3 class="solo-prediction-title"><i class="fas fa-robot"></i> Prediction IA - Vainqueur probable</h3>
                <p class="solo-prediction-subtitle">Analyse IA basee sur performances recentes et win rates.</p>
            </div>

            {% if showInternalToggle %}
                <button
                    type="button"
                    class="solo-prediction-toggle"
                    data-prediction-toggle-target="{{ panelId }}"
                    aria-expanded="true"
                    aria-controls="{{ panelId }}"
                >
                    <i class="fas fa-eye-slash"></i>
                    <span data-label>Masquer la prediction</span>
                </button>
            {% endif %}
        </div>

        <div class="solo-prediction-body" id="{{ panelId }}">
            {% if prediction.available|default(false) %}
                <div class="solo-prediction-grid">
                    <section class="solo-prediction-card">
                        <div class="solo-prediction-kicker">Favori IA</div>
                        <div class="solo-prediction-name">{{ prediction.winner.name }}</div>
                        <div class="solo-prediction-prob">{{ prediction.winner.winProbability }}%</div>

                        <div class="solo-prediction-chips">
                            <span class="solo-prediction-chip">Confiance: {{ prediction.confidence }}</span>
                            <span class="solo-prediction-chip">Win rate global: {{ prediction.winner.overallWinRate }}%</span>
                            <span class="solo-prediction-chip">Win rate {{ prediction.gameType }}: {{ prediction.winner.gameWinRate }}%</span>
                            <span class="solo-prediction-chip">ML: {{ prediction.winner.mlWinProbability }}%</span>
                            <span class="solo-prediction-chip muted">Matchs: {{ prediction.winner.matchesPlayed }}</span>
                        </div>
                    </section>

                    <section class="solo-prediction-table-wrap">
                        <table class="solo-prediction-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Participant</th>
                                    <th>Probabilite</th>
                                    <th>Win rate</th>
                                    <th>Win rate jeu</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in prediction.rankings %}
                                    <tr>
                                        <td><span class="solo-prediction-rank">{{ loop.index }}</span></td>
                                        <td>{{ row.name }}</td>
                                        <td>
                                            <div class="solo-prediction-prob-cell">
                                                <span>{{ row.winProbability }}%</span>
                                                <div class="solo-prediction-prob-bar">
                                                    <span style="width: {{ row.winProbability }}%"></span>
                                                </div>
                                            </div>
                                        </td>
                                        <td>{{ row.overallWinRate }}%</td>
                                        <td>{{ row.gameWinRate }}%</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </section>
                </div>
            {% else %}
                <div class="solo-prediction-empty">
                    <i class="fas fa-circle-info"></i>
                    <span>{{ prediction.reason|default('Prediction indisponible pour le moment.') }}</span>
                </div>
            {% endif %}
        </div>
    </article>

    <script>
        (function () {
            const bindToggle = function (btn) {
                if (!btn || btn.dataset.predictionBound === '1') {
                    return;
                }
                btn.dataset.predictionBound = '1';

                const targetId = btn.getAttribute('data-prediction-toggle-target');
                const target = targetId ? document.getElementById(targetId) : null;
                const label = btn.querySelector('[data-label]');
                const icon = btn.querySelector('i');

                if (!target) {
                    return;
                }

                btn.addEventListener('click', function () {
                    const hidden = target.hasAttribute('hidden');

                    if (hidden) {
                        target.removeAttribute('hidden');
                        btn.setAttribute('aria-expanded', 'true');
                        if (label) {
                            label.textContent = 'Masquer la prediction';
                        }
                        if (icon) {
                            icon.className = 'fas fa-eye-slash';
                        }
                        return;
                    }

                    target.setAttribute('hidden', '');
                    btn.setAttribute('aria-expanded', 'false');
                    if (label) {
                        label.textContent = 'Afficher la prediction';
                    }
                    if (icon) {
                        icon.className = 'fas fa-eye';
                    }
                });
            };

            document.querySelectorAll('.solo-prediction-toggle[data-prediction-toggle-target]').forEach(bindToggle);
        })();
    </script>
{% endif %}
