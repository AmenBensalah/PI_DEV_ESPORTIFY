{% extends 'base.html.twig' %}

{% block title %}Gestion des Recrutements - E-Sportify{% endblock %}

{% block body %}
<main class="main-content">
    <!-- Page Header -->
    <div class="page-header animate__animated animate__fadeInDown">
        <h1 class="hero-title" style="font-size: 42px; margin-bottom: 10px;">
            <i class="fas fa-user-plus"></i> GESTION DES RECRUTEMENTS
        </h1>
        <p class="hero-subtitle" style="margin-bottom: 40px;">
            Gérez les demandes d'adhésion à votre équipe
        </p>
    </div>

    <!-- Filter Tabs -->
    <div style="display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;">
        <button class="filter-tab active" data-status="all" onclick="filterRequests('all')">
            Toutes (<span id="count-all">{{ recrutements|length }}</span>)
        </button>
        <button class="filter-tab" data-status="en_attente" onclick="filterRequests('en_attente')">
            En attente (<span id="count-pending">{{ pendingCount }}</span>)
        </button>
        <button class="filter-tab" data-status="accepte" onclick="filterRequests('accepte')">
            Acceptées (<span id="count-accepted">{{ acceptedCount }}</span>)
        </button>
        <button class="filter-tab" data-status="refuse" onclick="filterRequests('refuse')">
            Refusées (<span id="count-refused">{{ refusedCount }}</span>)
        </button>
    </div>

    <!-- Stats Summary -->
    <div class="stats-section" style="margin-bottom: 40px;">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-inbox"></i>
            </div>
            <div class="stat-value">{{ recrutements|length }}</div>
            <div class="stat-label">Total</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-value">{{ pendingCount }}</div>
            <div class="stat-label">En attente</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-value">{{ acceptedCount }}</div>
            <div class="stat-label">Acceptées</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-times-circle"></i>
            </div>
            <div class="stat-value">{{ refusedCount }}</div>
            <div class="stat-label">Refusées</div>
        </div>
    </div>

    <!-- Recruitment Requests List -->
    <div id="requests-list" style="display: flex; flex-direction: column; gap: 20px; margin-bottom: 60px;">
        {% for recrutement in recrutements %}
        <div class="card recruitment-card animate__animated animate__fadeInUp" data-status="{{ recrutement.status }}" 
             style="padding: 25px; animation-delay: {{ loop.index0 * 0.05 }}s; {% if recrutement.status == 'accepte' %}border-color: var(--success-color);{% elseif recrutement.status == 'refuse' %}border-color: var(--primary-pink);{% endif %}">
            <div style="display: flex; gap: 20px; align-items: start;">
                <!-- Avatar -->
                <div style="flex-shrink: 0;">
                    <div style="width: 80px; height: 80px; border-radius: 50%; background: var(--gradient-1); display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: 700; border: 3px solid var(--primary-blue);">
                        {{ recrutement.nomRec|slice(0, 2)|upper }}
                    </div>
                </div>
                
                <!-- Content -->
                <div style="flex: 1;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                        <div>
                            <h3 style="font-size: 24px; margin-bottom: 8px; font-family: 'Orbitron', sans-serif;">
                                {{ recrutement.nomRec }}
                            </h3>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <span class="badge {% if recrutement.status == 'en_attente' %}badge-warning{% elseif recrutement.status == 'accepte' %}badge-success{% else %}badge-danger{% endif %}">
                                    {% if recrutement.status == 'en_attente' %}
                                        <i class="fas fa-clock"></i> EN ATTENTE
                                    {% elseif recrutement.status == 'accepte' %}
                                        <i class="fas fa-check-circle"></i> ACCEPTÉE
                                    {% else %}
                                        <i class="fas fa-times-circle"></i> REFUSÉE
                                    {% endif %}
                                </span>
                                <span class="badge badge-primary">
                                    <i class="fas fa-hashtag"></i> ID: {{ recrutement.id }}
                                </span>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <span style="color: var(--text-secondary); font-size: 14px; display: block;">
                                <i class="fas fa-calendar"></i> {{ recrutement.datePublication|date('d/m/Y') }}
                            </span>
                            <span style="color: var(--text-secondary); font-size: 14px; display: block; margin-top: 5px;">
                                <i class="fas fa-clock"></i> {{ recrutement.datePublication|date('H:i') }}
                            </span>
                        </div>
                    </div>
                    
                    <!-- Description -->
                    <div style="background: var(--darker-bg); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h4 style="font-size: 14px; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 10px; letter-spacing: 1px;">
                            <i class="fas fa-file-alt"></i> Lettre de motivation
                        </h4>
                        <p style="color: var(--text-primary); line-height: 1.8; font-size: 15px;">
                            {{ recrutement.description }}
                        </p>
                    </div>
                    
                    <!-- Actions -->
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                        {% if recrutement.status == 'en_attente' %}
                            <form method="post" action="{{ path('app_recrutements_accept', {'id': recrutement.id}) }}" style="display: inline;">
                                <button type="submit" class="btn-gradient" style="padding: 14px 28px;" onclick="return confirm('✅ Accepter cette demande ?')">
                                    <i class="fas fa-check"></i> Accepter
                                </button>
                            </form>
                            <form method="post" action="{{ path('app_recrutements_refuse', {'id': recrutement.id}) }}" style="display: inline;">
                                <button type="submit" class="btn-danger" style="padding: 14px 28px;" onclick="return confirm('❌ Refuser cette demande ?')">
                                    <i class="fas fa-times"></i> Refuser
                                </button>
                            </form>
                        {% endif %}
                        
                        <a href="{{ path('app_recrutements_show', {'id': recrutement.id}) }}" class="btn-outline" style="padding: 14px 28px;">
                            <i class="fas fa-eye"></i> Voir Détails
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-inbox"></i>
            </div>
            <h3 class="empty-title">Aucune Demande</h3>
            <p class="empty-text">
                Aucune demande de recrutement pour le moment
            </p>
        </div>
        {% endfor %}
    </div>

    <!-- Empty State (for filters) -->
    <div id="empty-filter" style="display: none;">
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-filter"></i>
            </div>
            <h3 class="empty-title">Aucun Résultat</h3>
            <p class="empty-text">
                Aucune demande ne correspond à ce filtre
            </p>
        </div>
    </div>

</main>
        event.target.closest('.filter-tab').classList.add('active');
        
        // Filter cards
        const cards = document.querySelectorAll('.recruitment-card');
        const requestsList = document.getElementById('requests-list');
        const emptyFilter = document.getElementById('empty-filter');
        let visibleCount = 0;
        
        cards.forEach(card => {
            const cardStatus = card.getAttribute('data-status');
            if (status === 'all' || cardStatus === status) {
                card.style.display = 'flex';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });
        
        // Show/hide empty state
        if (visibleCount === 0) {
            requestsList.style.display = 'none';
            emptyFilter.style.display = 'block';
        } else {
            requestsList.style.display = 'flex';
            emptyFilter.style.display = 'none';
        }
    }
</script>
{% endblock %}
