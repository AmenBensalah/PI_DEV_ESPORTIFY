{% extends 'admin/base.html.twig' %}

{% block title %}Utilisateurs - Admin{% endblock %}
{% block page_title %}Gestion des Utilisateurs{% endblock %}

{% block body %}
    <div style="margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; gap: 1rem;">
        <div style="flex: 1; display: flex; gap: 1rem;">
            <!-- Search Box -->
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Rechercher par nom..." class="search-input">
            </div>
            
            <!-- Sort Dropdown -->
            <select id="sortSelect" class="sort-select">
                <option value="name-asc">Trier par Nom (A-Z)</option>
                <option value="name-desc">Trier par Nom (Z-A)</option>
                <option value="id-asc">Trier par ID (Croissant)</option>
                <option value="id-desc">Trier par ID (DÃ©croissant)</option>
            </select>
        </div>

        <!-- Add Button -->
        <a href="{{ path('app_admin_user_new') }}" class="btn-gradient">
            <i class="fas fa-plus"></i> Ajouter un Utilisateur
        </a>
    </div>

    <div class="admin-table-container">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nom</th>
                    <th>Email</th>
                    <th>RÃ´le</th>
                    <th>Statut</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="usersTableBody">
                {% for user in users %}
                <tr class="user-row" data-name="{{ user.nom|lower }}" data-id="{{ user.id }}">
                    <td>#{{ user.id }}</td>
                    <td>
                        <div class="user-avatar-small">
                            <div class="avatar-circle">{{ user.nom|first|upper }}</div>
                            <span>{{ user.nom }}</span>
                        </div>
                    </td>
                    <td>{{ user.email }}</td>
                    <td>
                        {% if user.role.value == 'ROLE_ADMIN' %}
                            <span class="badge badge-admin">Admin</span>
                        {% elseif user.role.value == 'ROLE_JOUEUR' %}
                            <span class="badge badge-joueur">Joueur</span>
                        {% elseif user.role.value == 'ROLE_MANAGER' %}
                            <span class="badge badge-manager">Manager</span>
                        {% elseif user.role.value == 'ROLE_ORGANISATEUR' %}
                            <span class="badge badge-organisateur">Organisateur</span>
                        {% endif %}
                    </td>
                    <td><span class="status-active">ðŸŸ¢ Active</span></td>
                    <td>
                        <a href="{{ path('app_admin_user_show', {'id': user.id}) }}" class="btn-icon" title="Voir">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="{{ path('app_admin_user_edit', {'id': user.id}) }}" class="btn-icon" title="Ã‰diter">
                            <i class="fas fa-edit"></i>
                        </a>
                        <form method="post" action="{{ path('app_admin_user_delete', {'id': user.id}) }}" style="display: inline;" onsubmit="return confirm('ÃŠtes-vous sÃ»r de vouloir supprimer cet utilisateur ?');">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}">
                            <button type="submit" class="btn-icon" title="Supprimer">
                                <i class="fas fa-trash" style="color: var(--primary-pink);"></i>
                            </button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-muted);">
                        <i class="fas fa-inbox" style="font-size: 32px; margin-bottom: 10px; display: block;"></i>
                        Aucun utilisateur trouvÃ©
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <style>
        .search-container {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-container i {
            position: absolute;
            left: 15px;
            color: #aaa;
            pointer-events: none;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #9d4edd;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(157, 78, 221, 0.1);
        }

        .search-input::placeholder {
            color: #777;
        }

        .sort-select {
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .sort-select:focus {
            outline: none;
            border-color: #9d4edd;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(157, 78, 221, 0.1);
        }

        .sort-select option {
            background: #1b1e2e;
            color: white;
        }

        .user-row {
            animation: fadeIn 0.3s ease;
        }

        .user-row.hidden {
            display: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        .no-results i {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }
    </style>

    <script>
        const searchInput = document.getElementById('searchInput');
        const sortSelect = document.getElementById('sortSelect');
        const tableBody = document.getElementById('usersTableBody');
        const allRows = Array.from(document.querySelectorAll('.user-row'));

        function filterAndSort() {
            const searchTerm = searchInput.value.toLowerCase();
            const sortValue = sortSelect.value;

            // Filter rows based on search
            let filteredRows = allRows.filter(row => {
                const name = row.getAttribute('data-name');
                return name.includes(searchTerm);
            });

            // Sort the filtered rows
            filteredRows.sort((a, b) => {
                if (sortValue === 'name-asc') {
                    return a.getAttribute('data-name').localeCompare(b.getAttribute('data-name'));
                } else if (sortValue === 'name-desc') {
                    return b.getAttribute('data-name').localeCompare(a.getAttribute('data-name'));
                } else if (sortValue === 'id-asc') {
                    return parseInt(a.getAttribute('data-id')) - parseInt(b.getAttribute('data-id'));
                } else if (sortValue === 'id-desc') {
                    return parseInt(b.getAttribute('data-id')) - parseInt(a.getAttribute('data-id'));
                }
                return 0;
            });

            // Clear the table body
            tableBody.innerHTML = '';

            // Add filtered and sorted rows back
            if (filteredRows.length === 0) {
                const noResults = document.createElement('tr');
                noResults.innerHTML = '<td colspan="6" style="text-align: center; padding: 40px; color: var(--text-muted);"><i class="fas fa-search" style="font-size: 32px; margin-bottom: 10px; display: block;"></i>Aucun utilisateur trouvÃ©</td>';
                tableBody.appendChild(noResults);
            } else {
                filteredRows.forEach(row => {
                    tableBody.appendChild(row);
                });
            }
        }

        searchInput.addEventListener('input', filterAndSort);
        sortSelect.addEventListener('change', filterAndSort);

        // Initial sort
        filterAndSort();
    </script>
{% endblock %}
